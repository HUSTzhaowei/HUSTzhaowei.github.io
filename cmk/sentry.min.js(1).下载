!function(t,e){$(e).ready(function(){if(!t.APP_CONFIG||t.APP_CONFIG&&t.APP_CONFIG.ISSENTRY!==!1){var i="index",n=navigator.userAgent.toLowerCase(),a=["android","iphone","symbianos","windows phone","ipad","ipod"],o=a.some(function(t){return n.indexOf(t)>-1}),r="SENTRY_USAGE_INFO",s={},c=function(t,e){if(o)return!0;if(t.mod===i)return!0;if(e&&t.mod){e=e.slice(0),e.shift();var n=e.join("/"),a=t.mod===n;if(a)return!0;var r=!0;return $(t.mod.split("/")).each(function(t,i){return i!==e[t]?(r=!1,!1):void 0}),r}return e===t.mod},l=function(t,i){if(e.addEventListener){var n=this;e.addEventListener(i,function(e){var i=location.hash&&location.hash.split("/"),a=$(e.target);$.each(t,function(t,e){return c(e,i)&&n.isMatch(a,e.selector)?(s.collectUsage(e,n.getParams(),e),!1):void 0})},!0)}},h=function(t,i){var n=this;$.each(t,function(t,a){$(e).on(i,a.selector,function(){var t=arguments,e=location.hash&&location.hash.split("/");if(c(a,e)){var i=n.getParams.apply(n,t);s.collectUsage(a,i)}})})},u={click:{isMatch:function(t,e){try{return t.is(e)||t.closest($(e)).length}catch(i){return!1}},bindTrack:function(t){l.call(this,t,"click")},getParams:function(){return""}},grid:{isMatch:function(){},bindTrack:function(t){h.call(this,t,"search")},getParams:function(t,e){try{return JSON.parse(e)}catch(t){return{}}}},custCol:{isMatch:function(){},bindTrack:function(t){h.call(this,t,"custom.grid")},getParams:function(t,e){return e}},mod:{isMatch:function(){},bindTrack:function(e){var i=this;if(o&&e.length)s.collectUsage(e[0],i.getParams(e[0]));else{var n=function(){if(location.hash){var t=location.hash.split("/");$.each(e,function(e,n){return c(n,t)?(s.collectUsage(n,i.getParams(n)),!1):void 0})}};$(t).on("hashchange",n)}},getParams:function(e){var n="";if(t.APP_CONFIG.MODULES&&e.mod===i){var a=location.hash;$(t.APP_CONFIG.MODULES).each(function(){return a.indexOf(this.route)>-1?(n=JSON.stringify(this),!1):void 0})}return n}}},f=function(t,e){this.interval=t.interval,this.sendUrl=t.sendUrl,this.emitNum=t.emitNum,this.disable=t.disable,this.appLogs=e,this.sendUsageInfo(),this.sendTimeout()};f.prototype.collectUsage=function(t,e){if(!this.disable){var i=r+"_"+this.sendUrl,n=localStorage.getItem(i),a={id:t.id,device:o?"phone":"pc",eventTime:this.formatDate(new Date,"yyyy-MM-dd hh:mm:ss"),params:e||""};n?(localStorage.setItem(i,n+","+JSON.stringify(a)),localStorage.setItem(i+"_COUNT",1*localStorage.getItem(i+"_COUNT")+1)):(localStorage.setItem(i,JSON.stringify(a)),localStorage.setItem(i+"_COUNT","1")),1*localStorage.getItem(i+"_COUNT")>=this.emitNum&&this.sendUsageInfo()}},f.prototype.collectCustomLog=function(t,e){var i=this,n=location.hash&&location.hash.split("/"),a=this.appLogs;$(a).each(function(){return c(this,n)&&$.trim(this.selector)===$.trim(t)?(i.collectUsage(this,e),!1):void 0})},f.prototype.sendTimeout=function(){clearTimeout(this.sendTimer),this.sendTimer=setTimeout(this.sendUsageInfo.bind(this),this.interval)},f.prototype.sendUsageInfo=function(){var t=r+"_"+this.sendUrl,e=localStorage.getItem(t);if(e){localStorage.removeItem(t),localStorage.removeItem(t+"_COUNT");var i="["+e+"]";$.ajax({type:"POST",url:this.sendUrl,data:{d:i}})}this.sendTimeout()},f.prototype.formatDate=function(t,e){var i={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in i)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?i[n]:("00"+i[n]).substr((""+i[n]).length)));return e},f.prototype.enableSentry=function(){this.disable=!1,this.sendTimeout()},f.prototype.disableSentry=function(){this.disable=!0,t.clearTimeout(this.sendTimer)};var d=location.pathname.split("/"),g=d[d.indexOf("sys")+1];if(g){for(var m="",p=1;p<d.indexOf("sys");p++)m+="/"+d[p];var v=m+"/sys/emappagelog/config/"+g+".do";t.APP_CONFIG&&t.APP_CONFIG.SENTRY_CONFIG_URI&&(v=t.APP_CONFIG.SENTRY_CONFIG_URI),$.get(v,function(e){if($.isArray(e)){if(0===e.length)return;var i=function(){var i={interval:t.APP_CONFIG&&t.APP_CONFIG.SENTRYINTERVAL||2e4,sendUrl:m+"/sys/emappagelog/push.do",emitNum:t.APP_CONFIG&&t.APP_CONFIG.SENTRYEMITNUM||15,disable:!1};s=new f(i,e),t.ST=s;var n=function(t){var e=function(t,e){var i={};return t.forEach(function(t){if(t&&t[e]){var n=t[e];i[n]||(i[n]=[]),i[n].push(t)}}),i},i=e(t,"type");for(var n in i){var a=u[n];a&&a.bindTrack(i[n])}};n(e)};i()}})}}})}(window,document);